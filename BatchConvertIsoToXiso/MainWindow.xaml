<Window x:Class="BatchConvertIsoToXiso.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:services="clr-namespace:BatchConvertIsoToXiso.Services"
        Title="Batch Convert ISO to XISO"
        Height="850" Width="1200" MinHeight="650" MinWidth="700"
        Closing="Window_Closing"
        Loaded="Window_Loaded"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <!-- Converter for the XIso Explorer icons -->
        <services:FolderIconConverter x:Key="FolderIconConverter" />
    </Window.Resources>

    <Grid Background="#F5F5F5">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" /> <!-- 0: Header -->
            <RowDefinition Height="*" />    <!-- 1: Main Content -->
            <RowDefinition Height="Auto" /> <!-- 2: StatusBar -->
        </Grid.RowDefinitions>

        <!-- Header (RomValidator Style) -->
        <Border Grid.Row="0" Background="#1976D2" Padding="15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="Batch ISO to XISO" FontSize="20" FontWeight="Bold" Foreground="White" VerticalAlignment="Center" Margin="0,0,30,0" />
                    <Button x:Name="BtnNavConvert" Content="Convert" Click="NavConvert_Click" Style="{StaticResource MenuButtonStyle}" />
                    <Button x:Name="BtnNavTest" Content="Test Integrity" Click="NavTest_Click" Style="{StaticResource MenuButtonStyle}" />
                    <Button x:Name="BtnNavExplorer" Content="Explorer" Click="NavExplorer_Click" Style="{StaticResource MenuButtonStyle}" />
                </StackPanel>
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button Content="About" Click="AboutMenuItem_Click" Style="{StaticResource MenuButtonStyle}" Background="#9C27B0" ToolTip="View application information" />
                    <Button Content="Exit" Click="ExitMenuItem_Click" Style="{StaticResource MenuButtonStyle}" Background="#607D8B" ToolTip="Close the application" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Row="1" Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" /> <!-- 0: Operation Controls -->
                <RowDefinition Height="*" />    <!-- 1: Log/Explorer -->
                <RowDefinition Height="Auto" /> <!-- 2: Stats -->
                <RowDefinition Height="Auto" /> <!-- 3: Progress -->
            </Grid.RowDefinitions>

            <!-- 0. Operation Controls (Styled like RomValidator Borders) -->
            <Border x:Name="ControlsBorder" Grid.Row="0" Background="White" BorderBrush="#BDBDBD" BorderThickness="1" CornerRadius="4" Padding="15" Margin="0,0,0,10">
                <Grid>
                    <!-- Conversion View -->
                    <StackPanel x:Name="ConvertView">
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150" /><ColumnDefinition Width="*" /><ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Label Content="Source Folder:" FontWeight="SemiBold" VerticalAlignment="Center" />
                            <TextBox x:Name="ConversionInputFolderTextBox" Grid.Column="1" Style="{StaticResource CustomTextBoxStyle}" IsReadOnly="True" Margin="5,0" ToolTip="Select the folder containing ISO or archive files" />
                            <Button Grid.Column="2" Content="Browse..." Click="BrowseConversionInputButton_Click" Style="{StaticResource ActionButtonStyle}" ToolTip="Browse for source folder" />
                        </Grid>
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150" /><ColumnDefinition Width="*" /><ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Label Content="Output Folder:" FontWeight="SemiBold" VerticalAlignment="Center" />
                            <TextBox x:Name="ConversionOutputFolderTextBox" Grid.Column="1" Style="{StaticResource CustomTextBoxStyle}" IsReadOnly="True" Margin="5,0" ToolTip="Select the output folder for converted XISO files" />
                            <Button Grid.Column="2" Content="Browse..." Click="BrowseConversionOutputButton_Click" Style="{StaticResource ActionButtonStyle}" ToolTip="Browse for output folder" />
                        </Grid>
                        <Grid Margin="0,5,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <GroupBox Grid.Column="0" Header="Options" Margin="0,5,15,5" Padding="10,5">
                                <StackPanel Orientation="Vertical">
                                    <CheckBox x:Name="DeleteOriginalsCheckBox" Content="Delete original files after successful conversion" Margin="0,2,0,2" HorizontalAlignment="Left" ToolTip="Deletes the original ISO/archive if conversion is successful. Use with caution!" />
                                    <CheckBox x:Name="SearchSubfoldersConversionCheckBox" Content="Search for files in subfolders" Margin="0,8,0,8" HorizontalAlignment="Left" ToolTip="Include files found in subdirectories of the source folder" />
                                    <CheckBox x:Name="SkipSystemUpdateCheckBox" Content="Skip $SystemUpdate folder during conversion" Margin="0,2,0,2" HorizontalAlignment="Left" ToolTip="Omits the $SystemUpdate folder from the output XISO, reducing file size" />
                                    <CheckBox x:Name="CheckOutputIntegrityCheckBox" Content="Check integrity of the output file" Margin="0,8,0,8" HorizontalAlignment="Left" IsChecked="True" ToolTip="Performs a structural integrity check on the newly created XISO file" />
                                </StackPanel>
                            </GroupBox>
                            <GroupBox Grid.Column="1" Header="Conversion Method" Margin="0,5,0,5" Padding="10,5" VerticalAlignment="Top">
                                <StackPanel Orientation="Vertical">
                                    <RadioButton x:Name="UseExtractXisoRadioButton" Content="Use extract-xiso.exe (External Tool)" Margin="0,2" IsChecked="True" ToolTip="Uses the external extract-xiso.exe tool for conversion (default)" />
                                    <RadioButton x:Name="UseBuiltInLogicRadioButton" Content="Use Built-in Logic (Application Native)" Margin="0,2" ToolTip="Uses the application's built-in XISO conversion logic" />
                                </StackPanel>
                            </GroupBox>
                        </Grid>
                        <Button x:Name="StartConversionButton" Content="Start Conversion" Style="{StaticResource StartButtonStyle}" HorizontalAlignment="Center" Margin="0,5,0,0" Click="StartConversionButton_Click" ToolTip="Begin the batch conversion process" />
                    </StackPanel>

                    <!-- Test View (Hidden by default) -->
                    <StackPanel x:Name="TestView" Visibility="Collapsed">
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150" /><ColumnDefinition Width="*" /><ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Label Content="ISO Folder:" FontWeight="SemiBold" VerticalAlignment="Center" />
                            <TextBox x:Name="TestInputFolderTextBox" Grid.Column="1" Style="{StaticResource CustomTextBoxStyle}" IsReadOnly="True" Margin="5,0" ToolTip="Select the folder containing ISO files to test" />
                            <Button Grid.Column="2" Content="Browse..." Click="BrowseTestInputButton_Click" Style="{StaticResource ActionButtonStyle}" ToolTip="Browse for ISO folder" />
                        </Grid>
                        <GroupBox Header="Options" Margin="0,5,0,5" Padding="10,5">
                            <StackPanel Orientation="Vertical">
                                <CheckBox x:Name="MoveSuccessFilesCheckBox" Content="Move successfully tested ISOs to a '_success' subfolder" Margin="0,2,0,2" HorizontalAlignment="Left" IsChecked="False" ToolTip="Moves valid ISOs to a '_success' folder within the source folder" />
                                <CheckBox x:Name="MoveFailedFilesCheckBox" Content="Move failed tested ISOs to a '_failed' subfolder" Margin="0,8,0,8" HorizontalAlignment="Left" IsChecked="False" ToolTip="Moves invalid ISOs to a '_failed' folder within the source folder" />
                                <CheckBox x:Name="SearchSubfoldersTestCheckBox" Content="Search for files in subfolders" Margin="0,2,0,2" HorizontalAlignment="Left" ToolTip="Include files found in subdirectories of the input folder" />
                                <CheckBox x:Name="PerformDeepScanCheckBox" Content="Perform deep surface scan (slower)" Margin="0,8,0,2" HorizontalAlignment="Left" IsChecked="False" ToolTip="Reads entire ISO sequentially to detect bad sectors. Unchecked performs logical file test only (faster)." />
                            </StackPanel>
                        </GroupBox>
                        <Button x:Name="StartTestButton" Content="Start Integrity Test" Style="{StaticResource StartButtonStyle}" HorizontalAlignment="Center" Margin="0,5,0,0" Click="StartTestButton_Click" ToolTip="Begin the batch integrity test process" />
                    </StackPanel>

                    <!-- Explorer View Header -->
                    <StackPanel x:Name="ExplorerHeaderView" Visibility="Collapsed">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150" /><ColumnDefinition Width="*" /><ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Label Content="Select XISO File:" FontWeight="SemiBold" VerticalAlignment="Center" />
                            <TextBox x:Name="ExplorerFilePathTextBox" Grid.Column="1" Style="{StaticResource CustomTextBoxStyle}" IsReadOnly="True" Margin="5,0" ToolTip="Select an Xbox ISO file to explore its contents" />
                            <Button Content="Browse..." Grid.Column="2" Click="BrowseExplorerFile_Click" Style="{StaticResource ActionButtonStyle}" ToolTip="Browse for an XISO file" />
                        </Grid>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- 1. Log / Explorer Content -->
            <Grid Grid.Row="1">
                <Border x:Name="LogBorder" BorderBrush="#1a1a1a" BorderThickness="2" CornerRadius="4" Background="#0a0a0a">
                    <TextBox x:Name="LogViewer"
                             AcceptsReturn="True"
                             IsReadOnly="True"
                             FontFamily="Consolas"
                             FontSize="13"
                             Background="#0a0a0a"
                             Foreground="#39FF14"
                             BorderThickness="0"
                             VerticalScrollBarVisibility="Auto"
                             HorizontalScrollBarVisibility="Auto"
                             Padding="8"
                             CaretBrush="#39FF14">
                        <TextBox.Effect>
                            <DropShadowEffect ShadowDepth="0" Color="#39FF14" BlurRadius="2" Opacity="0.4"/>
                        </TextBox.Effect>
                    </TextBox>
                </Border>

                <Border x:Name="ExplorerBorder" Visibility="Collapsed" BorderBrush="#1a1a1a" BorderThickness="2" CornerRadius="4" Background="#0a0a0a" Padding="10">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" /> <!-- Navigation Bar -->
                            <RowDefinition Height="*" />    <!-- File List -->
                        </Grid.RowDefinitions>

                        <!-- Navigation Bar -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,5">
                            <Button x:Name="ExplorerUpButton" Content="â¬† Up" Click="ExplorerUpButton_Click" Width="60" Margin="0,0,10,0" IsEnabled="False" Style="{StaticResource ActionButtonStyle}" ToolTip="Go up one directory level" />
                            <TextBlock Text="Current Path: " VerticalAlignment="Center" FontWeight="Bold" Foreground="#39FF14" />
                            <TextBlock x:Name="ExplorerPathTextBlock" Text="/" VerticalAlignment="Center" Foreground="#39FF14" />
                        </StackPanel>

                        <!-- File List -->
                        <ListView x:Name="ExplorerListView" Grid.Row="1" MouseDoubleClick="ExplorerListView_MouseDoubleClick" BorderThickness="0" Background="#0a0a0a">
                            <ListView.ItemContainerStyle>
                                <Style TargetType="ListViewItem">
                                    <Setter Property="Padding" Value="10,5" />
                                    <Setter Property="BorderThickness" Value="0,0,0,1" />
                                    <Setter Property="BorderBrush" Value="#1a1a1a" />
                                    <Setter Property="Background" Value="#0a0a0a" />
                                    <Setter Property="Foreground" Value="#39FF14" />
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#1a1a1a" />
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="#2a2a2a" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </ListView.ItemContainerStyle>
                            <ListView.View>
                                <GridView>
                                    <GridView.ColumnHeaderContainerStyle>
                                        <Style TargetType="GridViewColumnHeader">
                                            <Setter Property="Background" Value="#0a0a0a" />
                                            <Setter Property="Foreground" Value="#39FF14" />
                                            <Setter Property="BorderBrush" Value="#1a1a1a" />
                                            <Setter Property="BorderThickness" Value="0,0,0,1" />
                                            <Setter Property="Padding" Value="10,5" />
                                            <Setter Property="FontWeight" Value="Bold" />
                                        </Style>
                                    </GridView.ColumnHeaderContainerStyle>
                                    <GridViewColumn Header="Name" Width="450">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="{Binding IsDirectory, Converter={StaticResource FolderIconConverter}}" Margin="0,0,5,0" Foreground="#39FF14" />
                                                    <TextBlock Text="{Binding Name}" Foreground="#39FF14" />
                                                </StackPanel>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="Size" Width="120">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding SizeFormatted}" Foreground="#39FF14" />
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="Type" Width="100">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Type}" Foreground="#39FF14" />
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </Grid>
                </Border>
            </Grid>

            <!-- 2. Stats Panel (RomValidator Style) -->
            <Grid x:Name="StatsPanel" Grid.Row="2" Margin="0,10,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Border Grid.Column="0" BorderBrush="#BDBDBD" BorderThickness="1" Margin="2" Padding="8" CornerRadius="4" Background="White">
                    <StackPanel>
                        <TextBlock Text="Total Files:" FontWeight="SemiBold" HorizontalAlignment="Center" /><TextBlock x:Name="TotalFilesValue" Text="0" HorizontalAlignment="Center" />
                    </StackPanel>
                </Border>
                <Border Grid.Column="1" BorderBrush="#BDBDBD" BorderThickness="1" Margin="2" Padding="8" CornerRadius="4" Background="White">
                    <StackPanel>
                        <TextBlock Text="Success:" FontWeight="SemiBold" Foreground="Green" HorizontalAlignment="Center" /><TextBlock x:Name="SuccessValue" Text="0" HorizontalAlignment="Center" />
                    </StackPanel>
                </Border>
                <Border Grid.Column="2" BorderBrush="#BDBDBD" BorderThickness="1" Margin="2" Padding="8" CornerRadius="4" Background="White">
                    <StackPanel>
                        <TextBlock Text="Failed:" FontWeight="SemiBold" Foreground="Red" HorizontalAlignment="Center" /><TextBlock x:Name="FailedValue" Text="0" HorizontalAlignment="Center" />
                    </StackPanel>
                </Border>
                <Border Grid.Column="3" BorderBrush="#BDBDBD" BorderThickness="1" Margin="2" Padding="8" CornerRadius="4" Background="White">
                    <StackPanel>
                        <TextBlock Text="Skipped:" FontWeight="SemiBold" Foreground="Orange" HorizontalAlignment="Center" /><TextBlock x:Name="SkippedValue" Text="0" HorizontalAlignment="Center" />
                    </StackPanel>
                </Border>
                <Border Grid.Column="4" BorderBrush="#BDBDBD" BorderThickness="1" Margin="2" Padding="8" CornerRadius="4" Background="White">
                    <StackPanel>
                        <TextBlock Text="Time:" FontWeight="SemiBold" HorizontalAlignment="Center" /><TextBlock x:Name="ProcessingTimeValue" Text="00:00:00" HorizontalAlignment="Center" />
                    </StackPanel>
                </Border>
                <Border Grid.Column="5" BorderBrush="#BDBDBD" BorderThickness="1" Margin="2" Padding="8" CornerRadius="4" Background="White">
                    <StackPanel>
                        <TextBlock Text="Read Speed:" FontWeight="SemiBold" HorizontalAlignment="Center" />
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock x:Name="ReadSpeedValue" Text="N/A" />
                            <TextBlock x:Name="ReadSpeedDriveIndicator" Text="" Margin="5,0,0,0" />
                        </StackPanel>
                    </StackPanel>
                </Border>
                <Border Grid.Column="6" BorderBrush="#BDBDBD" BorderThickness="1" Margin="2" Padding="8" CornerRadius="4" Background="White">
                    <StackPanel>
                        <TextBlock Text="Write Speed:" FontWeight="SemiBold" HorizontalAlignment="Center" />
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock x:Name="WriteSpeedValue" Text="N/A" />
                            <TextBlock x:Name="WriteSpeedDriveIndicator" Text="" Margin="5,0,0,0" />
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- 3. Progress Area -->
            <Grid x:Name="ProgressAreaGrid" Grid.Row="3" Margin="0,10,0,0" Visibility="Collapsed">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" /><ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Border BorderBrush="#BDBDBD" BorderThickness="1" CornerRadius="4" Padding="1" Background="White">
                    <Grid>
                        <ProgressBar x:Name="ProgressBar" Height="24" Foreground="#4CAF50" Background="Transparent" BorderThickness="0" />
                        <TextBlock x:Name="ProgressTextBlock" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="SemiBold" />
                    </Grid>
                </Border>
                <Button x:Name="CancelButton" Grid.Column="1" Content="Cancel" Style="{StaticResource CancelButtonStyle}" Margin="10,0,0,0" Visibility="Collapsed" Click="CancelButton_Click" ToolTip="Cancel the current operation" />
            </Grid>
        </Grid>

        <!-- Status Bar -->
        <StatusBar Grid.Row="2" Background="#E0E0E0" Padding="5">
            <StatusBarItem>
                <TextBlock x:Name="StatusTextBlock" Text="Ready." />
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>